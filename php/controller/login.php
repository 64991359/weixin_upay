<?php namespace controller;  class login { public function index($param) { $m = new \lib\model();  if (filter_input(INPUT_SERVER, 'REQUEST_METHOD') == 'POST') { $username = filter_input(INPUT_POST, 'user');  $bool = preg_match("/^[0-9]{1,12}$/", $username);  if ($bool === false) { ajax(array('code' => 1, 'msg' => '账号格式不正确！'));  } $sql = "select * from `device` where username='$username'";  $device = $m->find($sql);  if (!$device) { ajax(array('code' => 1, 'msg' => '没有找到账号！'));  } $pwd = filter_input(INPUT_POST, 'pwd');  if (md5($pwd) !== $device['passwd']) { ajax(array('code' => 1, 'msg' => '密码不正确！'));  } $userinfo = $m->find("select id,status from `user` where id={$device['user_id']}");  if (!$userinfo) { ajax(array('code' => 1, 'msg' => '没有找到用户信息！'));  } if ((int) $userinfo['status'] !== 1) { ajax(array('code' => 1, 'msg' => '用户已经禁用，请联系管理员！'));  } $res['user_id'] = $userinfo['id'];  $res['device_id'] = $device['id'];  $res['token'] = md5($device['username'] . $device['passwd'] . time() );  $redis = new \lib\yredis();  $redis->setex("upay_token_" . $res['token'], 86400 ,$userinfo['id']);      $redis->setex("upay_tokendevice_" . $device['id'], 86400 ,$res['token']);   ajax(array('code' => 0, 'msg' => 'ok', 'data' => $res));  } else { ajax(array('code' => 1, 'msg' => '请求方式错误！'));  } } } 